---
description: "Claudipedia code quality - decoupled full-stack patterns"
alwaysApply: true
---

# Code Quality Rules

## Architecture

This is a **decoupled full-stack** application:
- `web/` - Next.js 15 frontend (port 3001)
- `backend/` - FastAPI Python backend (port 8000)
- Neo4j graph database

## Core Principles

### 1. DRY - Don't Repeat Yourself
- Share type definitions conceptually (TypeScript â†” Pydantic)
- Centralize API client in `web/lib/api/`
- Centralize Neo4j queries in `backend/services/`

### 2. SSOT - Single Source of Truth
| Data | Location |
|------|----------|
| API Types (TS) | `web/lib/types.ts` |
| API Models (Py) | `backend/models/` |
| Graph Schema | `src/core/schema.py` |
| Config | `.env` files (not committed) |

### 3. Offline Mode
Frontend MUST support offline mode with mock data:
```typescript
const useMock = process.env.NEXT_PUBLIC_USE_MOCK_DATA === 'true';
```

## TypeScript Standards

```typescript
// Explicit types, named exports
export interface Claim {
  id: string;
  content: string;
  confidence: number;
}

// Async/await, proper error handling
export async function fetchClaims(): Promise<Claim[]> {
  try {
    const res = await fetch(`${API_URL}/claims`);
    if (!res.ok) throw new Error('Failed to fetch');
    return res.json();
  } catch (error) {
    console.error('fetchClaims failed:', error);
    return [];
  }
}
```

## Python Standards

```python
# Pydantic models with validation
from pydantic import BaseModel, Field

class ClaimCreate(BaseModel):
    content: str = Field(..., min_length=1)
    confidence: float = Field(..., ge=0, le=1)

# Type hints, async functions
async def create_claim(data: ClaimCreate) -> Claim:
    ...
```

## Don't

- Mix frontend/backend code
- Skip offline fallbacks
- Hardcode URLs or credentials
- Add console.log/print in production code
